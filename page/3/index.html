<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Travis&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Travis's Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Travis's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Travis's Blog">
  
    <link rel="alternate" href="/atom.xml" title="Travis&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Travis&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-如何调试多文件上传" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/27/如何调试多文件上传/" class="article-date">
  <time datetime="2017-03-27T07:46:30.000Z" itemprop="datePublished">2017-03-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/27/如何调试多文件上传/">如何调试多文件上传</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="服务器如何设置？"><a href="#服务器如何设置？" class="headerlink" title="服务器如何设置？"></a>服务器如何设置？</h2><p>我调试的时候使用的是PHP服务器，只写一句话：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print_r($_FILES);</div></pre></td></tr></table></figure>
<h2 id="App端如何设置？"><a href="#App端如何设置？" class="headerlink" title="App端如何设置？"></a>App端如何设置？</h2><p>客户端直接使用的是[okhttputils][1]，上传代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">OkHttpUtils.post()</div><div class="line">    .url(<span class="string">"http://192.168.1.28/demo/index.php"</span>)</div><div class="line">    .addFile(<span class="string">"file[]"</span>, paths.get(<span class="number">0</span>).substring(paths.get(<span class="number">0</span>).indexOf(<span class="string">"/"</span>)), <span class="keyword">new</span> File(paths.get(<span class="number">0</span>)))</div><div class="line">    .addFile(<span class="string">"file[]"</span>, paths.get(<span class="number">1</span>).substring(paths.get(<span class="number">1</span>).indexOf(<span class="string">"/"</span>)), <span class="keyword">new</span> File(paths.get(<span class="number">1</span>)))</div><div class="line">    .build()</div><div class="line">    .execute(<span class="keyword">new</span> StringCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Call call, Exception e, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">            Log.d(<span class="string">"MainActivity"</span>, <span class="string">"response="</span> + response);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"> * Try to return the absolute file path from the given Uri</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> context</div><div class="line"> * <span class="doctag">@param</span> uri</div><div class="line"> * <span class="doctag">@return</span> the file path or null</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRealFilePath</span><span class="params">(<span class="keyword">final</span> Context context, <span class="keyword">final</span> Uri uri)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == uri) <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">final</span> String scheme = uri.getScheme();</div><div class="line">    String data = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (scheme == <span class="keyword">null</span>)</div><div class="line">        data = uri.getPath();</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ContentResolver.SCHEME_FILE.equals(scheme)) &#123;</div><div class="line">        data = uri.getPath();</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ContentResolver.SCHEME_CONTENT.equals(scheme)) &#123;</div><div class="line">        Cursor cursor = context.getContentResolver().query(uri, <span class="keyword">new</span> String[]&#123;MediaStore.Images.ImageColumns.DATA&#125;, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != cursor) &#123;</div><div class="line">            <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</div><div class="line">                <span class="keyword">int</span> index = cursor.getColumnIndex(MediaStore.Images.ImageColumns.DATA);</div><div class="line">                <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</div><div class="line">                    data = cursor.getString(index);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            cursor.close();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="联调："><a href="#联调：" class="headerlink" title="联调："></a>联调：</h2><p>如果得到以下返回则说明成功了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">Array</div><div class="line">(</div><div class="line">  [file] =&gt; Array</div><div class="line">         (</div><div class="line">           [name] =&gt; Array</div><div class="line">                  (</div><div class="line">                    [0] =&gt; IMG_20161017_112752.jpg</div><div class="line">                    [1] =&gt; img-c6d422f96853ea6e7d73837b23d5fa3c.jpg</div><div class="line">                  )</div><div class="line"></div><div class="line">            [type] =&gt; Array</div><div class="line">                  (</div><div class="line">                     [0] =&gt;</div><div class="line">                     [1] =&gt; image/jpeg</div><div class="line">                  )</div><div class="line">            [tmp_name] =&gt; Array</div><div class="line">                      (</div><div class="line">                        [0] =&gt;</div><div class="line">                        [1] =&gt; D:\xampp\tmp\php65FE.tmp</div><div class="line">                      )</div><div class="line">            [error] =&gt; Array</div><div class="line">                      (</div><div class="line">                        [0] =&gt; 1</div><div class="line">                        [1] =&gt; 0</div><div class="line">                       )</div><div class="line">            [size] =&gt; Array</div><div class="line">                      (</div><div class="line">                         [0] =&gt; 0</div><div class="line">                         [1] =&gt; 50318</div><div class="line">                      )</div><div class="line">            )</div><div class="line">)</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/27/如何调试多文件上传/" data-id="cj0uytlgg000oawjhh522mr0s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-状态栏背景图片可滑动" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/27/状态栏背景图片可滑动/" class="article-date">
  <time datetime="2017-03-27T07:46:30.000Z" itemprop="datePublished">2017-03-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/27/状态栏背景图片可滑动/">状态栏背景图片可滑动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考文章：<br><a href="http://gold.xitu.io/entry/56b354e8c4c9710052e017aa/promote?utm_source=baidu&amp;utm_medium=keyword&amp;utm_content=android_statusbar&amp;utm_campaign=q3_search" target="_blank" rel="external">《Android 开发：Translucent System Bar 的最佳实践》</a></p>
<h2 id="关于透明状态栏"><a href="#关于透明状态栏" class="headerlink" title="关于透明状态栏"></a>关于透明状态栏</h2><p>仔细看了上面文章中的实现，发现不能完全满足项目需求，于是在上面项目的基础上做了一些修改，效果描述如下：</p>
<ul>
<li>图片（非背景图）占用StatusBar显示</li>
<li>图片可以随页面滑动</li>
<li>ActionBar和StatusBar随滑动距离透明度渐变</li>
<li>仅支持 <code>API&gt;19</code></li>
</ul>
<p>静态效果：<br><img src="http://7xvpu1.com1.z0.glb.clouddn.com/render-status-static.png" width="360/"><br>动态效果：<br><img src="../assets/transparent_effect.gif" width="360/"></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>在<code>API&gt;19</code>的手机上，可以在styles中设置<code>windowTranslucentStatus</code>属性使状态栏变透明，[1][同时Activity的布局也会占据原来StatusBar的位置]。</p>
<p>因为[1]的原因，ActionBar会上移和statusbar重叠，为了避免出现在种情况我们会考虑使用fitsSystemWindows，随之而来的问题就是图片不能显示在StatusBar下面了。这就是我在采用参考文章中的思路时遇到的问题，这个问题让我不得不考虑其它的实现方式。</p>
<p>回到问题的起点，<strong>设置<code>windowTranslucentStatus</code>属性后，ActionBar占用了StatusBar的位置。</strong> 在这里放置一个占位的View，高度设置为StatusBar的高度不就可以了吗？</p>
<p>我最终采用的就是上面的思路，满足了产品的需求。下面是代码部分，在上面基础上加了ActionBar随滑动距离的渐变：</p>
<p>styles：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//values-v19/styles.xml</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"ImageTranslucentTheme"</span></span></div><div class="line">  <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;<span class="xml"></span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowTranslucentStatus"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowTranslucentNavigation"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span>     </div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"windowActionBar"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>布局文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">//layout/activity_image_translucent_bar.xml</div><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:toolbar</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/scrollView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:fillViewport</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:overScrollMode</span>=<span class="string">"never"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"@dimen/ban_size"</span></div><div class="line">                <span class="attr">android:background</span>=<span class="string">"@mipmap/topinfo_ban_bg"</span> /&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"1234456678898900"</span></div><div class="line">                <span class="attr">android:textSize</span>=<span class="string">"200dp"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/topbar"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">View</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/status_placeholder"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">            <span class="attr">toolbar:navigationIcon</span>=<span class="string">"@mipmap/ic_drawer_home"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageTranslucentBarActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String STATUS_BAR_HEIGHT_RES_NAME = <span class="string">"status_bar_height"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ImageTranslucentBarActivity.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> GradientDrawable gradientDrawable; <span class="comment">//头部遮罩</span></div><div class="line">    <span class="keyword">private</span> LinearLayout topbar;<span class="comment">//标题栏+placeholder</span></div><div class="line">    <span class="keyword">private</span> View placeholder;<span class="comment">//占用statusbar的位置</span></div><div class="line">    <span class="keyword">private</span> Toolbar toolbar;</div><div class="line">    <span class="keyword">private</span> NestedScrollView scrollView;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> banSize;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mActionBarHeight;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mStatusBarHeight;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bufferDistance;<span class="comment">//缓冲距离</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threshold;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_image_translucent_bar);</div><div class="line">        placeholder = findViewById(R.id.status_placeholder);</div><div class="line">        topbar = (LinearLayout) findViewById(R.id.topbar);</div><div class="line">        toolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        scrollView = (NestedScrollView) findViewById(R.id.scrollView);</div><div class="line">        toolbar.inflateMenu(R.menu.base_toolbar_menu);</div><div class="line">        <span class="comment">//StatusBar占位</span></div><div class="line">        mStatusBarHeight = getInternalDimensionSize(getResources(),</div><div class="line">                STATUS_BAR_HEIGHT_RES_NAME);</div><div class="line">        LayoutParams params = (LayoutParams) placeholder.getLayoutParams();</div><div class="line">        params.height = mStatusBarHeight;</div><div class="line">        placeholder.setLayoutParams(params);</div><div class="line">        <span class="comment">//toolbar高度</span></div><div class="line">        mActionBarHeight = getActionBarHeight(<span class="keyword">this</span>);</div><div class="line">        <span class="comment">//图片高度</span></div><div class="line">        banSize = getResources().getDimensionPixelSize(R.dimen.ban_size);</div><div class="line">        bufferDistance = getResources()</div><div class="line">                .getDimensionPixelOffset(R.dimen.buffer_distance);</div><div class="line">        <span class="comment">//头部遮罩，之所以写在代码里，是因为要实现随滑动距离变色</span></div><div class="line">        gradientDrawable = (GradientDrawable) getResources()</div><div class="line">                .getDrawable(R.drawable.gradient_bg);</div><div class="line">        topbar.setBackgroundDrawable(gradientDrawable);</div><div class="line">        threshold = banSize - mStatusBarHeight + bufferDistance;</div><div class="line">        scrollView.setOnScrollChangeListener(</div><div class="line">                <span class="keyword">new</span> NestedScrollView.OnScrollChangeListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollChange</span><span class="params">(NestedScrollView v,</span></span></div><div class="line">                                       <span class="keyword">int</span> scrollX,</div><div class="line">                                       <span class="keyword">int</span> scrollY,</div><div class="line">                                       <span class="keyword">int</span> oldScrollX,</div><div class="line">                                       <span class="keyword">int</span> oldScrollY) &#123;</div><div class="line">                <span class="keyword">if</span> (scrollY &lt;= threshold) &#123;</div><div class="line">                    <span class="keyword">float</span> scale0 = Math.min(scrollY * <span class="number">1.0f</span> / (banSize - mStatusBarHeight</div><div class="line">                    - mActionBarHeight), <span class="number">1.0f</span>);</div><div class="line">                    <span class="keyword">float</span> scale1 = Math.min(scrollY * <span class="number">1.0f</span> / (banSize - mStatusBarHeight), <span class="number">1.0f</span>);</div><div class="line">                    <span class="keyword">int</span> startColor = Color.argb((<span class="keyword">int</span>) (<span class="number">255</span> * scale0), (<span class="keyword">int</span>) (<span class="number">254</span> * scale0),</div><div class="line">                            (<span class="keyword">int</span>) (<span class="number">134</span> * scale0), (<span class="keyword">int</span>) (<span class="number">158</span> * scale0));</div><div class="line">                    <span class="keyword">int</span> endColor = Color.argb((<span class="keyword">int</span>) (<span class="number">255</span> * scale1), (<span class="keyword">int</span>) (<span class="number">254</span> * scale1),</div><div class="line">                            (<span class="keyword">int</span>) (<span class="number">134</span> * scale1), (<span class="keyword">int</span>) (<span class="number">158</span> * scale1));</div><div class="line">                    <span class="keyword">int</span>[] colors = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;startColor, endColor&#125;;</div><div class="line">                    gradientDrawable.setColors(colors);</div><div class="line">                    topbar.setBackgroundDrawable(gradientDrawable);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@TargetApi</span>(<span class="number">14</span>)</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getActionBarHeight</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.ICE_CREAM_SANDWICH) &#123;</div><div class="line">            TypedValue tv = <span class="keyword">new</span> TypedValue();</div><div class="line">            context.getTheme().resolveAttribute(android.R.attr.actionBarSize, tv, <span class="keyword">true</span>);</div><div class="line">            result = TypedValue.complexToDimensionPixelSize(tv.data,</div><div class="line">                    context.getResources().getDisplayMetrics());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getInternalDimensionSize</span><span class="params">(Resources res, String key)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> resourceId = res.getIdentifier(key, <span class="string">"dimen"</span>, <span class="string">"android"</span>);</div><div class="line">        <span class="keyword">if</span> (resourceId &gt; <span class="number">0</span>) &#123;</div><div class="line">            result = res.getDimensionPixelSize(resourceId);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/27/状态栏背景图片可滑动/" data-id="cj0uytlgh000pawjhvzy01boq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-这个字段到底有没有返回" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/27/这个字段到底有没有返回/" class="article-date">
  <time datetime="2017-03-27T07:46:30.000Z" itemprop="datePublished">2017-03-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/27/这个字段到底有没有返回/">这个字段到底有没有返回</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>开发过程中总是会遇到诸如题目中的问题，前后端各执一词，有时不惜为此争得脸红脖子粗。这里记录一下，工作中我是怎么处理这些问题的，大家慎重参考，学艺不精被打脸，跟本人无关。</p>
<p>这篇文章主要讲这么几个方面：1.服务端到底有没有返回某个字段？2.客户端到底有没有传某个字段到服务端？3.服务端要求传数组，可是Http请求里面的数组是个什么鬼？各位乘客请系好安全带，马上就要发车了！</p>
<h2 id="1-服务端到底有没有返回某个字段？"><a href="#1-服务端到底有没有返回某个字段？" class="headerlink" title="1. 服务端到底有没有返回某个字段？"></a>1. 服务端到底有没有返回某个字段？</h2><p>核心思想就一句话：<code>重新请求，重新返回</code>。</p>
<p>我好想听见有人说:”我裤子都脱了，你给我看这个?”。这位乘客别生气，且容我慢慢道来。你可以在Android Monitor里面把返回的数据输出一下，然后把CTRL+C/V转发给服务端的同学。But！服务端的同学就开始跟你怼：”我返回的数据没有问题呀”；”你本地是不是加了缓存”；”你调错接口了吧”…Shut Up！即使你把他说服了，你还得配合他联调，绳命是剁么的回晃，绳命是入刺的井猜，哪能浪费在这些事情上。</p>
<p>我们的目标是重新构造一个请求，然后重放一下。为了构造这个请求，我们在原来网络请求框架上处理流程中添加一个方法，用以打印请求URL和请求参数。如果请求方式是GET，不妨直接把URL和参数拼接好，然后再打印。如果是post请求，相对麻烦一些，写一个html文件，用打印出来的URL和请求参数构建一个form表单，通过form表单，在浏览器中请求。</p>
<p>OK，现在你手里面有一个完整的URL或表单请求，如果后端同学不肯弯腰捡肥皂，你就可以把东西丢给他让他自己反省。</p>
<p>下面贴一下我用的表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>打脸神器<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></div><div class="line">    input&#123;</div><div class="line">      margin: 8px auto 8px 8px;</div><div class="line">    &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://www.baidu.com/s"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>word<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"word"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-客户端到底有没有传某个字段到服务端？"><a href="#2-客户端到底有没有传某个字段到服务端？" class="headerlink" title="2. 客户端到底有没有传某个字段到服务端？"></a>2. 客户端到底有没有传某个字段到服务端？</h2><p>有的时候自己都不确定调用接口的时候有没有把要求的字段传过去，这个时候完全看服务端大爷的脸色吗？怎么可能？他们还没那么拽(不过话又说回来，当你没有更好的办法的时候还是态度好一点，跟人家好好配合)。方法也就一句话:”在服务端检查一下客户端的传参”。快下班了，就不瞎扯别的了，赶紧写完收工。</p>
<p>直接讲我的做法，我在自己电脑上搭了一个PHP环境(PHP简单好用，你值得拥有)，然后把请求的URL重定向到本地的PHP页面。比如我的电脑局域网ip是 192.168.1.66，PHP服务器运行在80端口，PHP页面是index.php,客户端别的都不用变，只用把请求URL改成<a href="http://192.168.1.66:80/demo/index.php" target="_blank" rel="external">http://192.168.1.66:80/demo/index.php</a> 就可以在PHP服务器上接收到请求了。检验字段什么的，都不在话下。</p>
<p>这句神奇的PHP代码就是<code>echo $_REQUEST[&#39;参数名称&#39;]</code>。</p>
<h2 id="3-服务端要求传数组，可是Http请求里面的数组是个什么鬼？"><a href="#3-服务端要求传数组，可是Http请求里面的数组是个什么鬼？" class="headerlink" title="3. 服务端要求传数组，可是Http请求里面的数组是个什么鬼？"></a>3. 服务端要求传数组，可是Http请求里面的数组是个什么鬼？</h2><p>这个内容其实可以算是<code>2</code>的一个引申。服务端说让客户端传数组，前端同学一脸的懵比，What 数组？？？懵归懵，我还是有一点思路的。像<code>2</code>一样，我把请求重新定向到本地PHP页面，然后不断的改客户端代码，根据PHP的接收情况，不断尝试终于被我发现了真相！其实所谓的数组是一伪名词，客户端传过去的数据是这个样子的：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array[0]=value0&amp;array[1]=value1</div></pre></td></tr></table></figure></p>
<p>看完之后你可能也有点懵，直接上代码看看我是怎么处理的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Map&lt;String,String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">String array[] = <span class="keyword">new</span> String[]&#123;<span class="string">"value0"</span>,<span class="string">"value1"</span>&#125;;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;array.length;i++)&#123;</div><div class="line">    params.put(String.format(<span class="string">"array[%d]"</span>,i),array[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样一来，服务端就能按照解析数组来解析客户端的请求参数了。<br>上面介绍的方法并不局限于上面所提到的问题，开发过程中遇到的很多问题都可以用上面的方法来解决。<br>突然想到，如果使用fiddler抓包工具。。。难道我是拿着lowB技术在开车?不行，我得去研究一下！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/27/这个字段到底有没有返回/" data-id="cj0uytlgk000rawjhh4nsjlpl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/27/hello-world/" class="article-date">
  <time datetime="2017-03-26T17:11:48.000Z" itemprop="datePublished">2017-03-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/27/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/27/hello-world/" data-id="cj0uytlgd000mawjhfr50d870" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/28/Java动态代理Proxy/">Java动态代理Proxy</a>
          </li>
        
          <li>
            <a href="/2017/03/28/PhotoView使用过程中遇到的坑/">PhotoView使用过程中的坑</a>
          </li>
        
          <li>
            <a href="/2017/03/27/Looper和Handler类/">Looper和Handler类</a>
          </li>
        
          <li>
            <a href="/2017/03/27/Android布局文件中的onClick属性/">Android布局文件中的onClick属性</a>
          </li>
        
          <li>
            <a href="/2017/03/27/Android应用内开新进程的一些行为记录/">Android应用内开新进程的一些行为记录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Travis<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>